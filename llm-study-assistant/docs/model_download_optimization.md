# 模型下载优化功能说明

## 功能概述

为了避免重复下载已存在于本地的模型，我们在 `scripts/download_model.sh` 脚本中增加了模型存在性检查功能。该功能会在下载模型之前先检查 Ollama 服务中是否已存在相同名称的模型，如果已存在则跳过下载。

## 实现原理

1. **模型存在性检查**：
   - 使用 `curl http://localhost:11434/api/tags` 命令获取 Ollama 服务中已存在的模型列表
   - 解析返回的 JSON 数据，提取所有模型名称
   - 检查目标模型是否在已存在列表中

2. **跳过下载机制**：
   - 如果模型已存在，脚本会显示跳过提示并增加跳过计数器
   - 不执行 `ollama pull` 命令，直接进入下一个模型处理
   - 对于单模型下载，仍会更新 `.env` 文件中的配置

3. **统计信息展示**：
   - 显示总共处理的模型数量
   - 分别统计下载和跳过的模型数量
   - 提供清晰的操作结果反馈

## 使用方法

1. 运行下载脚本：
   ```bash
   ./scripts/download_model.sh
   ```

2. 选择需要的模型或批量下载选项

3. 脚本会自动检查并跳过已存在的模型

## 测试验证

经过测试验证，该功能可以正确识别已存在的模型并跳过下载：
- 当所有模型都已存在时，不会进行任何下载操作
- 正确更新统计信息，显示跳过的模型数量
- 对于单模型下载，仍会更新 `.env` 配置文件

## 注意事项

1. 模型名称必须完全匹配才会被认为是已存在的模型
2. 脚本区分不同的模型变体（如 qwen2.5:3b 和 qwen2.5:3b-instruct-q4_0 被视为不同模型）
3. 如果需要强制重新下载模型，需要先从 Ollama 中删除该模型再运行下载脚本